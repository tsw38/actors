<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>title</title>
	</head>
	<body>
		<form method="POST">
			Celebrity or Director:<br>
			<input type="text" name="celebrity"><br>
			<input type="submit" value="Submit">
		</form>
		<div id="chart-container"></div>
	</body>
	<script
		src="https://code.jquery.com/jquery-2.2.4.min.js"
		integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
		crossorigin="anonymous"></script>
	<script
		type="text/javascript"
		src="https://www.gstatic.com/charts/loader.js"></script>
	<script>
		$(() => {
			$('form').on('submit', (e) => {
				e.preventDefault();
				if(!$('input[name=celebrity]').val().length) return;
				$('body').append('<div class="loading" style="text-align:center; font-size:40px">Loading</div>');
				$.ajax({
					type: "POST",
					url: '/',
					data: {
						celebrity: $('input[name=celebrity]').val()
					},
					success: ({status, message}) => {
						if(status === 200){
							message = JSON.parse(message).map(movie => [movie.year, movie.rating || 0]);

							// Load the Visualization API and the corechart package.
							google.charts.load('current', {'packages':['corechart']});

							// Set a callback to run when the Google Visualization API is loaded.
							google.charts.setOnLoadCallback(drawChart);

							// Callback that creates and populates a data table,
							// instantiates the pie chart, passes in the data and
							// draws it.
							function drawChart() {
								// Create the data table.
								var data = new google.visualization.arrayToDataTable([['Year', 'Rating'], ...message]);


								// Set chart options
								var options = {
									'title':$('input[name=celebrity]').val() + ' RT over Time',
									hAxis: {title: 'Year'},
									vAxis: {title: 'Rating', minValue: 0},
									width: 800,
									height: 500,
									legend: 'none',
									trendlines: { 0: {} }    // Draw a trendline for data series 0.
								};

								// Instantiate and draw our chart, passing in some options.
								$('.loading').remove();
								var chart = new google.visualization.ScatterChart(document.getElementById('chart-container'));
								chart.draw(data, options);
							}
						} else {
							$('body').append(message);
						}

					}
				});
			})
		})
	</script>
</html>
